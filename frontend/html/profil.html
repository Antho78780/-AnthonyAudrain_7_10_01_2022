<!DOCTYPE html>
<html lang = "fr">
    <head>
        <title>profil Groupomania</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=500, initial-scale=1">  
        <link rel="stylesheet"  href="/frontend/css/style.css">
    </head>
    <body>
        <section id="app">
            <h1 class="modifFlex">Bienvenue {{user.prenom}}</h1>
            <p><strong>Prenom: </strong>{{user.prenom}} </p>
            <p><strong>Nom: </strong>{{user.nom}}</p>
            <p><strong>Email: </strong>{{user.email}}</p>
            <button @click="suppresion" type="button" class="modifButton">{{titreSuppresionCompte}}</button>
        </section>
        <script src="https://unpkg.com/vue@3"></script>

        <script>
            Vue.createApp({
                data() {
                    return {
                        titreSuppresionCompte: "Suppresion de mon compte",
                        user: ""
                    }  
                },
                mounted() {
                    const idUserssessionStorage = JSON.parse(sessionStorage.getItem("usersIdToken"));
                    const users_id = idUserssessionStorage[0];
                    fetch(`http://localhost:3000/users/getOneUsers/${users_id}`)
                    .then(res => res.json())
                    .then((data) => {
                        console.log(data)
                        this.user = data;
                    })
                },

                methods: {
                    suppresion() {
                        const idUserssessionStorage = JSON.parse(sessionStorage.getItem("usersIdToken"));
                        const users_id = idUserssessionStorage[0];
                        fetch(`http://localhost:3000/deleteUsers/${users_id}`, {
                            method: "DELETE",
                            headers: {
                                'Content-Type' : 'application/json'
                            }
                        })
                        .then((res) => {
                                if(res.ok) {
                                    alert("Votre compte à été supprimé")
                                    sessionStorage.removeItem("usersIdToken");
                                    window.location.href = "connexion.html";
                                }
                            })
                    }
                }
            })
            .mount("#app")
        </script>
    </body>
</html>