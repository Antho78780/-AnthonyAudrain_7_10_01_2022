<!DOCTYPE html>
<html lang = "fr">
    <head>
        <title>Accueil Groupomania</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=500, initial-scale=1">  
        <script src="https://kit.fontawesome.com/1a7b1ecd7e.js" crossorigin="anonymous"></script>
        <link rel="stylesheet"   href="/frontend/css/style.css">
    </head>
    <body>
        <div id="app">
            <main id="modifA">
                <img class="img1" :src="linkImg">
                <div id="flex-row">
                    <a :href="hrefProfil"  class="modifTitre modifFlex"><p>{{texteProfil}}</p></a>
                    <button @click="deconnecter" type="button" class="modifButton2 modifFlex">{{texteDeconnexion}}</button>
                </div>
            </main>
            <section id="section1">
                <h1 class="texte1">{{texteForums}}</h1>
                <a :href="hrefSujet"><p class="texte1">{{texteCreerSujet}}</p></a>
            </section>
            <article v-for="sujet in allSujet"  id="articleJs">
                    <h1 class="decoration titreSujet">{{sujet.titre}}</h1>
                    <p class="modifPrenom">{{sujet.auteur}}</p>
                    <p class="decoration">{{sujet.sujet}}</p>
                    <div id="flex">
                        <textarea  class="modifText"placeholder="Ecrivez un commentaire"></textarea>
                        <p class="modifTemp">Créer le: {{sujet.date}} </p>
                    </div>
                <!----
                <button type="button" class="modifButton mbutton">Supprimé le sujet</button>
                -->
            </article>
        </div>
        <script src="https://unpkg.com/vue@3"></script>
        <script>
            Vue.createApp({
                data() {
                    return {
                        apiGetAllSujet: "http://localhost:3000/post/getAllPost",
                        texteCreerSujet : "Créer un nouveau sujet",
                        texteDeconnexion: "Déconnexion",
                        texteForums: "Forums",
                        texteProfil : "Profil",
                        hrefProfil: "profil.html",
                        hrefSujet: "sujet.html",
                        linkImg: "../images/icon-left-font-monochrome-black.svg",
                        allSujet: [],
                    }
                },
                mounted() {
                    fetch(this.apiGetAllSujet)
                    .then(res => res.json())
                    .then((allPost) => {
                        for(let post of allPost) {
                           let date = new Date(post.createdAt);
                           const datePost = date.toLocaleDateString() + " à " + date.toLocaleTimeString();
                           fetch(`http://localhost:3000/users/getOneUsers/${post.userId}`)
                            .then(res => res.json())
                            .then((user) => {
                                this.allSujet.push({
                                    titre: post.titre,
                                    sujet: post.sujet,
                                    date: datePost,
                                    auteur: user.prenom
                                })
                            })
                        }
                    })
                },
                methods: {
                    deconnecter() {
                       window.location.href = "connexion.html";
                       sessionStorage.removeItem("usersIdToken");
                    },
                    envoisComments() {
                        console.log("ok");
                        
                    }
                }
            })
            .mount("#app")
        </script>
    </body>
</html>